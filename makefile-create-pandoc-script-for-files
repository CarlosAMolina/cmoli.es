DOCKER_CUSTOM_IMAGE_NAME=python-create-pandoc-script
DOCKER_CONTAINER_NAME=$(DOCKER_CUSTOM_IMAGE_NAME)-container
DOCKER_IMAGE_NAME=python:3.8.15-alpine3.16
DOCKER_VOLUME_PANDOC_SOURCE=pandoc
DOCKER_VOLUME_PANDOC_TARGET=/volume-$(DOCKER_VOLUME_PANDOC_SOURCE)
DOCKER_VOLUME_WEB_CONTENT_SOURCE=nginx-web-content
DOCKER_VOLUME_WEB_CONTENT_TARGET=/volume-$(DOCKER_VOLUME_WEB_CONTENT_SOURCE)

pull-docker-image:
	docker pull $(DOCKER_IMAGE_NAME)

build-docker-image:
	docker build -t $(DOCKER_CUSTOM_IMAGE_NAME) .

create-docker-volumes:
	docker volume create $(DOCKER_VOLUME_PANDOC_SOURCE)
	docker volume create $(DOCKER_VOLUME_WEB_CONTENT_SOURCE)

run-container:
	docker run \
		-it \
		--rm \
		-d \
		--name $(DOCKER_CONTAINER_NAME) \
		--mount type=volume,source=$(DOCKER_VOLUME_PANDOC_SOURCE),target=$(DOCKER_VOLUME_PANDOC_TARGET) \
		--mount type=volume,source=$(DOCKER_VOLUME_WEB_CONTENT_SOURCE),target=$(DOCKER_VOLUME_WEB_CONTENT_TARGET) \
		$(DOCKER_CUSTOM_IMAGE_NAME)

copy-files-to-volumes:
	#sudo /bin/bash copy-files-to-docker-volumes $(DOCKER_VOLUME_PANDOC_SOURCE) $(DOCKER_VOLUME_WEB_CONTENT_SOURCE)
	/bin/bash copy-files-to-docker-volumes $(DOCKER_VOLUME_PANDOC_SOURCE) $(DOCKER_VOLUME_WEB_CONTENT_SOURCE)

run: pull-docker-image build-docker-image create-docker-volumes copy-files-to-volumes run-container

stop:
	docker stop $(DOCKER_CONTAINER_NAME)

connect:
	docker exec -it $(DOCKER_CONTAINER_NAME) /bin/sh

